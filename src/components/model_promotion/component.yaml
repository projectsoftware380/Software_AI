# src/components/model_promotion/component.yaml
name: Model Promotion Gate
description: >
  Decides if the new model (LSTM + Filter) should be promoted to production.
  It performs a 3-step check: 1) Is the filtered strategy profitable?
  2) Does the filter significantly improve the base strategy? 3) Is the new
  filtered strategy better than the current production model?

inputs:
  - {name: new_metrics_dir, type: String}
  - {name: new_lstm_artifacts_dir, type: String}
  - {name: new_filter_model_path, type: String, description: "GCS path to the trained filter model directory."}
  - {name: pair, type: String}
  - {name: timeframe, type: String}
  - {name: production_base_dir, type: String}

outputs:
  - {name: model_promoted, type: String, description: "'true' if the model is promoted, 'false' otherwise."}

implementation:
  container:
    image: gcr.io/trading-ai-460823/trading-ai-gpu:v1
    command:
      - python
      - -m
      - src.components.model_promotion.task
    args:
      - --new-metrics-dir
      - {inputValue: new_metrics_dir}
      - --new-lstm-artifacts-dir
      - {inputValue: new_lstm_artifacts_dir}
      - --new-filter-model-path
      - {inputValue: new_filter_model_path}
      - --pair
      - {inputValue: pair}
      - --timeframe
      - {inputValue: timeframe}
      - --production-base-dir
      - {inputValue: production_base_dir}
    fileOutputs:
      model_promoted: /tmp/model_promoted.txt
