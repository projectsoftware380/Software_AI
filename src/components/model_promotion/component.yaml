# src/components/model_promotion/component.yaml
name: Decide Model Promotion
description: Evaluates backtest metrics against production metrics and promotion thresholds. If the new model is approved, it copies its artifacts to the production GCS directory.

inputs:
  - name: new_metrics_dir
    type: String
    description: 'The GCS path to the directory containing the new candidate model''s metrics.json.'
  - name: new_lstm_artifacts_dir
    type: String
    description: 'The GCS path to the directory of the new LSTM model to be promoted.'
  - name: new_rl_model_path
    type: String
    description: 'The GCS path to the new RL model .zip file to be promoted.'
  - name: pair
    type: String
    description: 'The trading pair being evaluated.'
  - name: timeframe
    type: String
    description: 'The timeframe of the model being evaluated.'
  - name: production_base_dir
    type: String
    description: 'The base GCS directory for all production models.'

outputs:
  - name: model_promoted
    type: Boolean
    description: 'A boolean value indicating if the model was promoted to production (true) or not (false).'

implementation:
  container:
    image: europe-west1-docker.pkg.dev/trading-ai-460823/data-ingestion-repo/data-ingestion-agent:latest
    command:
      - python
      - -m
      - src.components.model_promotion.task
    args:
      - --new-metrics-dir
      - {inputValue: new_metrics_dir}
      - --new-lstm-artifacts-dir
      - {inputValue: new_lstm_artifacts_dir}
      - --new-rl-model-path
      - {inputValue: new_rl_model_path}
      - --pair
      - {inputValue: pair}
      - --timeframe
      - {inputValue: timeframe}
      - --production-base-dir
      - {inputValue: production_base_dir}
      - --model-promoted-output
      - {outputPath: model_promoted}