# ────────────────────────────────────────────────────────────────
# src/components/data_ingestion/component.yaml
# ────────────────────────────────────────────────────────────────
name: ingest-market-data-for-all-pairs
description: >
  Descarga/actualiza datos OHLC históricos desde Polygon.io para todos los
  pares de divisas y guarda los Parquet en GCS.

inputs:
  - name: project_id
    type: String
  - name: timeframe
    type: String
  - name: polygon_secret_name        # ← coincide con main.py y task.py
    type: String
  - name: start_date
    type: String
    default: "2010-01-01"
  - name: end_date
    type: String
    default: "2100-01-01"
  - name: min_rows
    type: Integer
    default: 100000

outputs:
  - name: completion_message
    type: String

implementation:
  container:
    image: gcr.io/trading-ai-460823/trading-ai-gpu:v1
    command:
      - python
      - -m                           # ← módulo, no ruta de archivo
      - src.components.data_ingestion.task
    args:
      - --project-id
      - {inputValue: project_id}
      - --timeframe
      - {inputValue: timeframe}
      - --polygon-secret-name
      - {inputValue: polygon_secret_name}
      - --start-date
      - {inputValue: start_date}
      - --end-date
      - {inputValue: end_date}
      - --min-rows
      - {inputValue: min_rows}
      - --completion-message-path
      - {outputPath: completion_message}
