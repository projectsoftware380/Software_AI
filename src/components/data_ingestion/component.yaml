# src/components/data_ingestion/component.yaml
name: Ingest Market Data for All Pairs
description: Fetches and updates raw OHLC market data from Polygon.io for a predefined list of currency pairs and stores them in GCS as Parquet files.

inputs:
  - name: timeframe
    type: String
    description: 'The timeframe for the data, e.g., 15minute.'
  - name: project_id
    type: String
    description: 'The Google Cloud Project ID where the component is running.'
  - name: polygon_secret_name
    type: String
    description: 'Name of the secret in Secret Manager containing the Polygon API key.'
  - name: start_date
    type: String
    description: 'Start date for data fetching in YYYY-MM-DD format.'
    default: '2010-01-01'
  - name: end_date
    type: String
    description: 'End date for data fetching in YYYY-MM-DD format. Defaults to today.'
  - name: min_rows
    type: Integer
    description: 'Minimum number of rows required for the download to be considered successful.'
    default: 100000

outputs:
  - name: completion_message
    type: String
    description: 'A message indicating the result of the ingestion task for all pairs.'

implementation:
  container:
    # Se añade un placeholder para que KFP pueda cargar el componente.
    # El script de la pipeline (main.py) lo sobreescribirá con la imagen real.
    image: placeholder-image
    command:
      - python
      - -m
      - src.components.data_ingestion.task
    args:
      - --timeframe
      - {inputValue: timeframe}
      - --project-id
      - {inputValue: project_id}
      - --polygon-secret-name
      - {inputValue: polygon_secret_name}
      - --start-date
      - {inputValue: start_date}
      - --end-date
      - {inputValue: end_date}
      - --min-rows
      - {inputValue: min_rows}
      - --completion-message-path
      - {outputPath: completion_message}