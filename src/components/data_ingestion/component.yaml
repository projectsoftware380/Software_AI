# -----------------------------------------------------------------------------
# component.yaml: Componente de Ingestión de Datos (Corregido)
# -----------------------------------------------------------------------------
name: Ingest Market Data for All Pairs
description: |
  Orquesta la descarga de datos históricos para todos los pares de divisas
  desde Polygon.io, los guarda en GCS y notifica los resultados.

inputs:
  - {name: project_id,          type: String, description: "ID del proyecto de Google Cloud."}
  - {name: polygon_secret_name, type: String, description: "Nombre del secreto en Secret Manager para la API key de Polygon."}
  - {name: end_date,            type: String, description: "Fecha final para la descarga de datos (YYYY-MM-DD)."}
  - {name: timeframe,           type: String, description: "Timeframe de las velas (ej: '15minute')."}
  - {name: pair,                type: String, description: "El par de divisas específico a procesar (ej: 'EURUSD')."}

# --- CORRECCIÓN: Añadida la sección de 'outputs' ---
# Se declara la salida que el script necesita para poder pasar su ruta.
outputs:
  - {name: completion_message,  type: String, description: "Mensaje que indica la finalización de la tarea."}

implementation:
  container:
    image: "gcr.io/your-project/your-image:latest"  # Esta será reemplazada por el main.py
    command: [
      python, -u, -m, src.components.data_ingestion.task,
      --project-id,           {inputValue: project_id},
      --polygon-secret-name,  {inputValue: polygon_secret_name},
      --end-date,             {inputValue: end_date},
      --timeframe,            {inputValue: timeframe},
      --pair,                 {inputValue: pair},
      # --- CORRECCIÓN: Se pasa la ruta de la salida al script ---
      # Esto resuelve el error del argumento '--completion-message-path' faltante.
      --completion-message-path, {outputPath: completion_message},
    ]