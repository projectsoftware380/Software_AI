# src/components/train_lstm_launcher/component.yaml
name: Launch Vertex AI LSTM Training Job
description: Submits and monitors a Vertex AI Custom Job to train the final LSTM model on dedicated hardware. This component itself runs on a standard KFP node.

inputs:
  - name: project_id
    type: String
    description: 'The GCP Project ID.'
  - name: region
    type: String
    description: 'The GCP region for the Vertex AI Custom Job, e.g., us-central1.'
  - name: pair
    type: String
    description: 'The trading pair for which the model is being trained.'
  - name: timeframe
    type: String
    description: 'The timeframe for which the model is being trained.'
  - name: params_path
    type: String
    description: 'GCS path to the best_params.json file from the optimization step.'
  - name: output_gcs_base_dir
    type: String
    description: 'Base GCS directory where the training job will save its versioned artifacts.'
  - name: vertex_training_image_uri
    type: String
    description: 'The URI of the Docker container image to use for the training job (the "runner" image).'
  - name: vertex_machine_type
    type: String
    description: 'The machine type for the Vertex AI training job, e.g., n1-standard-4.'
    default: 'n1-standard-4'
  - name: vertex_accelerator_type
    type: String
    description: 'The type of GPU accelerator for the training job.'
    default: 'ACCELERATOR_TYPE_UNSPECIFIED'
  - name: vertex_accelerator_count
    type: Integer
    description: 'The number of GPUs to attach to the training job.'
    default: 0
  - name: vertex_service_account
    type: String
    description: 'The service account email for the training job to run as.'

outputs:
  - name: trained_lstm_dir_path
    type: String
    description: 'The full GCS path to the newly created, versioned directory containing the trained model, scaler, and params.'

implementation:
  container:
    image: europe-west1-docker.pkg.dev/trading-ai-460823/data-ingestion-repo/data-ingestion-agent:latest
    command:
      - python
      - -m
      - src.components.train_lstm_launcher.task
    args:
      - --project-id
      - {inputValue: project_id}
      - --region
      - {inputValue: region}
      - --pair
      - {inputValue: pair}
      - --timeframe
      - {inputValue: timeframe}
      - --params-path
      - {inputValue: params_path}
      - --output-gcs-base-dir
      - {inputValue: output_gcs_base_dir}
      - --vertex-training-image-uri
      - {inputValue: vertex_training_image_uri}
      - --vertex-machine-type
      - {inputValue: vertex_machine_type}
      - --vertex-accelerator-type
      - {inputValue: vertex_accelerator_type}
      - --vertex-accelerator-count
      - {inputValue: vertex_accelerator_count}
      - --vertex-service-account
      - {inputValue: vertex_service_account}
      - --trained-lstm-dir-path-output
      - {outputPath: trained_lstm_dir_path}