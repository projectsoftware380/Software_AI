# src/components/backtest/component.yaml
name: backtest-strategy
description: >
  Ejecuta el backtest combinando las predicciones del LSTM y el filtro PPO.
  Sube los CSV de trades y un JSON con métricas a GCS.

inputs:
  # === AJUSTE: Se añade la URI de la imagen como un parámetro de entrada ===
  - name: image_uri
    type: String
    description: 'URI de la imagen Docker a utilizar para ejecutar el componente.'
  # =======================================================================
  - {name: lstm_model_dir,   type: String,  description: "gs://…/…/…/LSTM/<timestamp>"}
  - {name: rl_model_path,    type: String,  description: "gs://…/ppo_filter_model.zip"}
  - {name: features_path,    type: String,  description: "gs://…_unseen.parquet"}
  - {name: pair,             type: String}
  - {name: timeframe,        type: String}

outputs:
  - {name: output_gcs_dir,        type: String, description: "Carpeta GCS con CSV + metrics"}
  - {name: kfp_metrics_artifact,  type: String, description: "Ruta al JSON de métricas para Vertex UI"}

implementation:
  container:
    # === AJUSTE: La imagen ahora es dinámica y viene de los inputs ===
    image: {inputValue: image_uri}
    # ================================================================
    command:
      - python
      - -m
      - src.components.backtest.task
    args:
      - --lstm-model-dir
      - {inputValue: lstm_model_dir}
      - --rl-model-path
      - {inputValue: rl_model_path}
      - --features-path
      - {inputValue: features_path}
      - --pair
      - {inputValue: pair}
      - --timeframe
      - {inputValue: timeframe}
    fileOutputs:
      output_gcs_dir: /tmp/backtest_dir.txt
      kfp_metrics_artifact: /tmp/kfp_metrics.json