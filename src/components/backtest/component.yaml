# src/components/backtest/component.yaml
name: Perform Final Backtest
description: >
  Runs a comprehensive backtest on the hold-out dataset. It compares the
  base strategy (LSTM only) against the filtered strategy (LSTM + LightGBM).
  Generates a detailed HTML report with QuantStats, CSVs, and metrics.

inputs:
  - {name: lstm_model_dir, type: String, description: "GCS path to the trained LSTM model directory."}
  - {name: filter_model_path, type: String, description: "GCS path to the trained LightGBM filter model directory."}
  - {name: features_path, type: String, description: "GCS path to the hold-out dataset (.parquet)."}
  - {name: pair, type: String}
  - {name: timeframe, type: String}

outputs:
  - {name: output_gcs_dir, type: String, description: "GCS folder with the full backtest report (HTML, CSVs, metrics)."}
  - {name: kfp_metrics_artifact, type: String, description: "Path to the metrics JSON for the Vertex AI UI."}

implementation:
  container:
    image: placeholder-image
    command:
      - python
      - -m
      - src.components.backtest.task
    args:
      - --lstm-model-dir
      - {inputValue: lstm_model_dir}
      - --filter-model-path
      - {inputValue: filter_model_path}
      - --features-path
      - {inputValue: features_path}
      - --pair
      - {inputValue: pair}
      - --timeframe
      - {inputValue: timeframe}
    fileOutputs:
      output_gcs_dir: /tmp/backtest_dir.txt
      kfp_metrics_artifact: /tmp/kfp_metrics.json